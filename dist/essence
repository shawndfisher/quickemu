#!/usr/bin/env bash

INFO="Essence|-|https://nakst.gitlab.io/essence|A desktop operating system built from scratch, for control and simplicity."

GUEST="essence"
IMAGE_TYPE="img"

function dist_releases() {
    echo latest
}

function dist_image_get() {
    local TMPURL="$(curl -Ls -o /dev/null -w %{url_effective} https://github.com/nakst/build-essence/releases/${RELEASE})"
    local HASH=""
    local URL="${TMPURL//\/tag\//\/download\/}"
    local ISO="Essence.tar.xz"
    echo "${URL}/${ISO}"
}

function dist_image_post_get() {
    if [[ ${ISO} = *".tar.xz"* ]]; then
        tar --strip-components=1 -xJf ${VM_PATH}/${ISO} -C ${VM_PATH}
        rm -f "${VM_PATH}/Essence.ova" "${VM_PATH}/Essence.tar.xz"
        mv "${VM_PATH}/drive" "${VM_PATH}/essence.img"
        ISO="$(ls -1 "${VM_PATH}/"*.img | cut -d'/' -f2)"
    fi
}

function dist_vm_option_tweak() {
    echo "boot=\"legacy\"" >> "${CONF_FILE}"
}

# vim:tabstop=4:shiftwidth=4:expandtab
