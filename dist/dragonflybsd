#!/usr/bin/env bash

PRETTY_NAME="DragonFlyBDS"
HOMEPAGE="https://www.dragonflybsd/org"
INFO="DragonFlyBSD|FreeBSD|-|https://www.dragonflybsd.org/|Provides an opportunity for the BSD base to grow in an entirely different direction from the one taken in the FreeBSD, NetBSD, and OpenBSD series."

GUEST="dragonflybsd"

function dist_releases() {
    # If you remove "".bz2" from the end of the searched URL, you will get only the current release - currently 6.4.0
    # We could add a variable so this behaviour is optional/switchable (maybe from option or env)
    echo $(web_pipe "http://mirror-master.dragonflybsd.org/iso-images/" | grep -E -o '"dfly-x86_64-.*_REL.iso.bz2"' | grep -o -E '[[:digit:]]+\.[[:digit:]]+\.[[:digit:]]+')
}

function dist_image() {
    local HASH=""
    local ISO="dfly-x86_64-${RELEASE}_REL.iso.bz2"
    local URL="http://mirror-master.dragonflybsd.org/iso-images"
    HASH=$(web_pipe "${URL}/md5.txt" | grep "(${ISO})" | cut -d' ' -f4)
    echo "${URL}/${ISO} ${HASH}"
}

function dist_vm_option_tweak() {
    echo "boot=\"legacy\"" >> "${CONF_FILE}"
}

function dist_image_handle() {
    bzip2 -d  "${VM_PATH}/${ISO}"
    ISO="${ISO/.bz2/}"
}

# vim:tabstop=4:shiftwidth=4:expandtab
